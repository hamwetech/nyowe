{% extends 'base.html' %}
{% load humanize %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'bower_components/c3js-chart/c3.min.css' %}" media="all">
{% endblock %}

{% block page_content %}


<div class="uk-grid uk-grid-width-large-1-1 uk-grid-width-medium-1-2 uk-grid-medium " >
    <div class="uk-width-medium-1-1">
        <div class="md-card">
            <div class="md-card-content">
                <table>
                    <tr>
                        <th>MEMBERS - Filters: </th>
                        <td>Year</td>
                        <td>
                            <select id="year_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>Region</td>
                        <td>
                            <select id="region_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>District</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                </table>
                <hr/>
                <br/>
                <div id="c3_member_chart_bar_stacked_month" class="c3chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="uk-grid uk-grid-width-large-1-1 uk-grid-width-medium-1-2 uk-grid-medium " >
    <div class="uk-width-medium-1-1">
        <div class="md-card">
            <div class="md-card-content">
                <table>
                    <tr>
                        <th>COLLECTIONS - Filters: </th>
                        <td>Year</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>Region</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>District</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                </table>
                <hr/>
                <br/>
                <div class="uk-grid uk-grid-width-large-1-2 uk-grid-width-medium-1-2 uk-grid-medium " >
                    <div>
                        <div class="md-card-content">
                            <div class="uk-float-right uk-margin-top uk-margin-small-right"><span class="peity_visitors peity_data">5,3,9,6,5,9,7</span></div>
                            <span class="uk-text-muted uk-text-small">Weights and Amounts</span>
                            <h2 class="uk-margin-remove">{{ members }}</h2>
                            <div id="c3_collections_weights_and_amounts_chat" class="c3chart"></div>
                        </div>
                    </div>
                    <div>
                        <div class="md-card-content">
                            <div class="uk-float-right uk-margin-top uk-margin-small-right"><span class="peity_visitors peity_data">5,3,9,6,5,9,7</span></div>
                            <span class="uk-text-muted uk-text-small">Distribution of Collections</span>
                            <div id="c3_collections_item_distribution_chat_orders" class="c3chart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="uk-grid uk-grid-width-large-1-1 uk-grid-width-medium-1-2 uk-grid-medium " >
    <div class="uk-width-medium-1-1">
        <div class="md-card">
            <div class="md-card-content">
                <table>
                    <tr>
                        <th>ORDERS - Filters: </th>
                        <td>Year</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>Region</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>District</td>
                        <td>
                            <select id="month_filter_id">
                                <option value="">------</option>
                                {% for month_number, month_name in months_choices %}
                                    <option value="{{ month_number }}" {% if month_number == current_month %} selected="selected" {% endif %}>{{ month_name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                </table>
                <hr/>
                <br/>
                <div class="uk-grid uk-grid-width-large-1-2 uk-grid-width-medium-1-2 uk-grid-medium " >
                    <div>
                        <div class="md-card-content">
                            <div class="uk-float-right uk-margin-top uk-margin-small-right"><span class="peity_visitors peity_data">5,3,9,6,5,9,7</span></div>
                            <span class="uk-text-muted uk-text-small">Counts and Amount (UGX)</span>
                            <h2 class="uk-margin-remove">{{ members }}</h2>
                            <div id="c3_order_counts_and_amounts_chat" class="c3chart"></div>
                        </div>
                    </div>
                    <div>
                        <div class="md-card-content">
                            <div class="uk-float-right uk-margin-top uk-margin-small-right"><span class="peity_visitors peity_data">5,3,9,6,5,9,7</span></div>
                            <span class="uk-text-muted uk-text-small">Items Purchased</span>
                            <div id="c3_ordered_items_purchase_chat" class="c3chart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block page_specific_scripts %}
        <script src="{% static 'bower_components/d3/d3.min.js' %}"></script>
        <script src="{% static 'bower_components/c3js-chart/c3.min.js' %}"></script>
        <!--<script src="{% static 'assets/js/pages/plugins_charts.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/metrics-graphics/dist/metricsgraphics.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/chartist/dist/chartist.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/maplace-js/dist/maplace.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/peity/jquery.peity.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/jquery.easy-pie-chart/dist/jquery.easypiechart.min.js' %}"></script>-->
        <script src="{% static 'bower_components/countUp.js/countUp.min.js' %}"></script>
        <!--<script src="{% static 'bower_components/handlebars/handlebars.min.js' %}"></script>-->
        <!--<script src="{% static 'assets/js/custom/handlebars_helpers.min.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/clndr/src/clndr.js' %}"></script>-->
        <!--<script src="{% static 'bower_components/fitvids/jquery.fitvids.js' %}"></script>-->

   <script>
       let year_filter_id = $('#year_filter_id').val()
       let region_filter_id = $('#region_filter_id').val()
       let district_filter_id = $('#district_filter_id').val()

       $('#year_filter_id').on('change', function(){
            let year_filter_id = $('#year_filter_id').val()
            get_member_dashboard(year_filter_id);
       })

       $('#region_filter_id').on('change', function(){
            let region_filter_id = $('#region_filter_id').val()
            get_member_dashboard(region_filter_id);
       })

       $('#district_filter_id').on('change', function(){
            let district_filter_id = $('#district_filter_id').val()
            get_member_dashboard(district_filter_id);
       })

       get_member_dashboard(year_filter_id)
       function get_member_dashboard(year_filter_id){
            $.ajax({
                url: '/insights/data/members-overview/',
                method: 'GET',
                data: {year: year_filter_id},
                dataType: 'json',
                success: function(data) {
                    let chart = c3.generate({
                    bindto: '#c3_member_chart_bar_stacked_month',
                    data: {
                      columns: [
                          data.female, data.male
                      ],
                      types: 'bar',
                    },
                    axis: {
                        y: {
                            label: {
                              text: 'Profiled Members',
                              position: 'outer-middle'
                            },
                            tick: {
                              format: d3.format("") // ADD
                            }
                        },
                        x: {
                            type: 'category',
                            categories: data.legend,
                            label: {
                                text: 'Months',
                                position: 'outer-middle'
                            }
                        },
                    }
                });
                },
                error: function(xhr, status, error) {
                    console.error('Error:', status, error);
                }
            });
       }

      $.ajax({
        url: '/insights/data/collections-overview/',
        method: 'GET',
        data: {year: year_filter_id},
        dataType: 'json',
        success: function(data) {
           let chart = c3.generate({
                bindto: '#c3_collections_weights_and_amounts_chat', // c3_collections_item_distribution_chat_orders
                data: {
                    // iris data from R
                    columns: [
                        ['Male', data.male],
                        ['Female', data.female],
                    ],
                    type : 'donut',
                    onclick: function (d, i) { console.log("onclick", d, i); },
                    onmouseover: function (d, i) { console.log("onmouseover", d, i); },
                    onmouseout: function (d, i) { console.log("onmouseout", d, i); }
                }
            });
        }
       });


       $.ajax({
            url: '/insights/data/orders-overview/',
            method: 'GET',
            data: {year: year_filter_id},
            dataType: 'json',
            success: function(data) {
                columns = []
                $.each(data.data, function(index, item) {
                    let columnName = item.item_id;
                    let totalQuantity = parseFloat(item.total_quantity);
                    columns.push([columnName, totalQuantity]);
                });
               let chart = c3.generate({
                    bindto: '#c3_order_counts_and_amounts_chat',  // c3_ordered_items_purchase_chat
                    data: {
                        // iris data from R
                        columns,
                        type : 'pie',
                        onclick: function (d, i) { console.log("onclick", d, i); },
                        onmouseover: function (d, i) { console.log("onmouseover", d, i); },
                        onmouseout: function (d, i) { console.log("onmouseout", d, i); }
                    }
                });
            }
       });

    </script>
    {% endblock %}-->